## **视频瘦身器 (Video Slimmer) App 产品需求文档 (PRD)**

| 文档版本     | V1.0                                         |
| :----------- | :------------------------------------------- |
| **产品名称** | 视频瘦身器 (Video Slimmer)                   |
| **创建日期** | 2023-10-27                                   |
| **创建人**   | (你的名字)                                   |
| **文档状态** | 待开发                                       |

### **1. 简介**

#### **1.1 产品背景**
随着智能手机摄像头能力的飞速发展，用户可以轻松录制 4K 甚至 8K 的高清视频。这些视频文件体积巨大，不仅迅速占满手机宝贵的存储空间，也给分享带来了极大的不便——大部分社交应用和电子邮件服务都对附件大小设有严格限制。

#### **1.2 产品愿景**
“视频瘦身器”旨在成为一款极致简洁、功能强大的移动端视频压缩工具。我们致力于通过智能的压缩算法和友好的用户界面，让每一位用户都能轻松、快速地缩小视频体积，从而解决存储焦虑和分享困难的问题。

#### **1.3 目标用户**
*   **存储空间敏感者:** 手机容量经常告急，希望释放空间的用户。
*   **社交分享达人:** 频繁通过微信、Discord、Telegram 等平台分享视频的用户。
*   **手机摄影爱好者:** 拍摄大量高质量视频素材，需要进行初步处理的用户。

### **2. 产品功能需求**

#### **2.1 功能总览**

| 编号   | 功能模块             | 需求描述                                                                                                                                                                                                            | 优先级 | 迭代版本 |
| :----- | :------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :----- | :------- |
| **F1** | **视频选择与管理**   |                                                                                                                                                                                                                     |        |          |
| F1.1   | 视频信息提取         | 从系统相册加载视频，并提取其关键元数据，包括：缩略图、文件名、时长、文件大小、**分辨率**和**帧率**。                                                                                                                    | **高**   | V1.0     |
| F1.2   | 视频列表排序         | 提供排序功能，支持按 **文件大小** (升序/降序) 和 **拍摄时间** (升序/降序) 对视频列表进行排序。默认按文件大小降序。                                                                                                      | **高**   | V1.0     |
| F1.3   | 视频列表过滤         | 提供过滤功能，允许用户根据**分辨率与帧率**的组合（如 4K/60fps, 1080p/30fps等）筛选视频。                                                                                                                             | **高**   | V1.0     |
| F1.4   | 多视频选择           | 支持用户在列表中同时选择一个或多个视频进行后续处理。                                                                                                                                                                          | **高**   | V1.5     |
| **F2** | **压缩参数配置**     |                                                                                                                                                                                                                     |        |          |
| F2.1   | 预设压缩方案         | 提供 “高画质”、“平衡模式”、“极限压缩” 等简单明了的预设选项，背后对应不同的压缩参数。                                                                                                                                  | **高**   | V1.0     |
| F2.2   | 自定义压缩参数       | 允许高级用户自定义**分辨率**和**画质**（通过调整 CRF 或码率），以获得更精细的控制。                                                                                                                                       | **中**   | V1.5     |
| F2.3   | 压缩结果预估         | 根据用户选择的压缩参数，实时估算压缩后的文件大小，并与原始大小进行对比。                                                                                                                                                    | **高**   | V1.0     |
| **F3** | **压缩处理**         |                                                                                                                                                                                                                     |        |          |
| F3.1   | 压缩进度显示         | 清晰地展示单个视频和总体任务的压缩进度（百分比、进度条），并预估剩余时间。                                                                                                                                                | **高**   | V1.0     |
| F3.2   | 后台压缩与取消       | 压缩任务应在后台线程执行，不阻塞 UI。用户可以随时取消正在进行的压缩任务。App 退至后台时，压缩应能继续进行（遵循系统限制）。                                                                                              | **高**   | V1.0     |
| **F4** | **结果处理**         |                                                                                                                                                                                                                     |        |          |
| F4.1   | 结果对比与预览       | 压缩完成后，清晰展示每个视频压缩前后的文件大小对比及节省的空间。提供内置播放器，方便用户预览压缩后的视频质量。                                                                                                              | **高**   | V1.0     |
| F4.2   | 保存与分享           | 用户可以将压缩后的一个或多个视频保存到系统相册，或直接调用系统分享菜单发送给其他应用。                                                                                                                                        | **高**   | V1.0     |
| F4.3   | 删除原始视频         | 提供一个“删除原始视频”的选项，以彻底释放空间。**此操作必须有醒目的警告和二次确认弹窗。**                                                                                                                                  | **中**   | V2.0     |
| **F5** | **其他**             |                                                                                                                                                                                                                     |        |          |
| F5.1   | 权限处理             | 首次使用时，以友好的方式引导用户授予相册/存储访问权限。                                                                                                                                                                     | **高**   | V1.0     |
| F5.2   | 历史记录             | 提供一个页面展示最近的压缩历史，方便用户查找、再次分享或删除已处理过的文件。                                                                                                                                                | **低**   | V2.0     |

#### **2.2 非功能性需求**
*   **性能:** UI 响应流畅，列表滚动无卡顿。视频元数据加载快速。压缩算法应尽可能高效利用设备性能。
*   **易用性:** 界面设计遵循“Don't make me think”原则，核心流程（选择-配置-压缩）一气呵成。
*   **隐私:** 所有视频处理均在用户设备本地完成，绝不上传任何用户文件，确保用户数据隐私与安全。
*   **兼容性:** 稳定运行于主流的 Android (8.0+) 和 iOS (13.0+) 系统版本。
*   **健壮性:** 对各种异常情况（如权限被拒、文件损坏、压缩失败等）有优雅的错误处理和提示。

---

### **3. UI/UX 概念设计与用户流程**

#### **3.1 用户流程**
`打开App` -> `(首次)授予权限` -> `**主屏幕** (浏览、排序、过滤视频)` -> `选择一个或多个视频` -> `进入**压缩设置页**` -> `选择预设或自定义参数` -> `点击“开始压缩”` -> `进入**压缩进度页**` -> `压缩完成` -> `进入**结果页**` -> `预览、保存或分享视频` -> `(可选)删除原始视频`

#### **3.2 UI 概念图 (ASCII Wireframes)**

**1. 主屏幕 (视频选择页)**
```
+------------------------------------------------+
| [视频瘦身器]                              (i)  |
+------------------------------------------------+
| [排序: 文件大小(降序) v]  [过滤: 全部视频 v]   |
+------------------------------------------------+
|                                                |
| [vid] Party.mp4       ( )  [vid] Travel.mp4  (v)|
| 4K/60 | 10:05 | 8.5 GB       4K/30| 05:20 | 4.3 GB  |
|                                                |
| [vid] 2023-10-27.mp4  ( )  [vid] Selfie.mov  ( )|
| 4K/30 | 01:30 | 1.2 GB       1080p/30| 00:15 | 90 MB|
|                                                |
| ... (可滚动) ...                             |
|                                                |
+------------------------------------------------+
| 已选择: 1 个视频 (共 4.3 GB)                   |
|               [ 下一步(1) ]                    |
+------------------------------------------------+
```

**2. 排序与过滤弹窗 (Modal Bottom Sheet)**
```
// 排序弹窗                             // 过滤弹窗
+-------------------------+            +----------------------------+
| [排序方式]              |            | [按分辨率与帧率过滤]         |
|                         |            |                            |
| (•) 文件大小 (由大到小) |            | [v] 全部视频               |
| ( ) 文件大小 (由小到大) |            | ---                        |
| ( ) 拍摄时间 (由近到远) |            | [ ] 4K / 60 fps            |
| ( ) 拍摄时间 (由远到近) |            | [ ] 4K / 30 fps            |
|         [确认]          |            | ... (更多选项) ...         |
+-------------------------+            |           [确认]             |
                                       +----------------------------+
```

**3. 压缩设置页**
```
+------------------------------------------------+
| < 返回        压缩设置 (1个视频)               |
+------------------------------------------------+
| [ 预设方案 ]                                   |
|   (•) 高画质 (推荐)                            |
|   ( ) 平衡模式                                 |
|   ( ) 极限压缩 (适合分享)                      |
+------------------------------------------------+
| [ 自定义设置 v ]  <-- (V1.5) 点击展开详细设置    |
+------------------------------------------------+
| 预计结果:                                      |
|   原始大小: 4.3 GB                             |
|   压缩后约:  1.7 GB (节省 ~2.6 GB)              |
+------------------------------------------------+
|                                                |
|           [ 开始压缩 ]                         |
|                                                |
+------------------------------------------------+
```

**4. 压缩进度页**
```
+------------------------------------------------+
|                正在压缩...                     |
+------------------------------------------------+
| Travel.mp4                                     |
| [█████████████████-----------] 75%            |
| 预计剩余时间: 约 2 分 15 秒                   |
+------------------------------------------------+
|  (应用可在后台继续运行，完成后将发送通知)      |
+------------------------------------------------+
|               [ 取消压缩 ]                     |
+------------------------------------------------+
```

**5. 压缩结果页**

```
+------------------------------------------------+
| < 完成          🎉 压缩成功!                   |
+------------------------------------------------+
| 总共为你节省了 2.6 GB 空间！                     |
+------------------------------------------------+
| [>] Travel.mp4                                 |  <-- 点击播放预览
|     原始: 4.3 GB  ->  压缩后: 1.7 GB (-60%)    |
|     [ 分享 ]  [ 全部保存 ]                     |
+------------------------------------------------+
|                                                |
|           [  !! 删除 1 个原始视频 !!  ]        |  <--- (V2.0) 危险操作
|           [   返回首页   ]                         |
|                                                |
+------------------------------------------------+
```

---

### **4. 技术考虑**

*   **核心技术:** `flutter_ffmpeg`。这是实现所有视频处理功能（压缩、转码、元数据提取）的基础。
*   **元数据提取:** 使用 `flutter_ffmpeg` 内置的 `ffprobe` 工具来分析视频文件，获取分辨率、帧率等详细信息。
*   **高级媒体库:** 为了更好的性能和更强大的查询能力（尤其是在处理排序和过滤时），可以考虑使用 `photo_manager` 库代替 `image_picker`。
*   **权限处理:** 使用 `permission_handler` 库来优雅地请求和管理权限。
*   **状态管理:** 推荐使用 `Riverpod` 或 `Bloc` 来管理复杂的 UI 状态，如筛选条件、选择列表和压缩进度。
*   **后台任务:** 耗时的压缩任务必须放在 `Isolate` 中执行，以防止 UI 线程被冻结。

### **5. 迭代计划 (Roadmap)**

*   **V1.0 - MVP (最小可行产品):**
    *   **目标:** 发布一个功能完整、体验流畅的核心版本。
    *   **包含功能:** F1.1, F1.2, F1.3, F2.1, F2.3, F3.1, F3.2, F4.1, F4.2 (单视频保存), F5.1。
    *   **用户场景:** 用户可以选择单个视频，使用预设方案进行压缩，并保存到相册。

*   **V1.5 - 效率增强版:**
    *   **目标:** 提升处理效率和灵活性。
    *   **包含功能:** F1.4 (多视频选择), F2.2 (自定义参数), F4.2 (批量保存与分享)。

*   **V2.0 - 专业功能版:**
    *   **目标:** 提供更多专业级管理功能。
    *   **包含功能:** F4.3 (删除原始视频), F5.2 (历史记录)。

---

### **6. 品牌设计系统**

#### **6.1 主题色彩搭配**

| 颜色名称              | 十六进制代码 | 用途描述                        |
| :-------------------- | :----------- | :------------------------------ |
| **prosperity-black**  | `#0A0A0A`    | 主背景色，纯正黑色              |
| **prosperity-gold**   | `#B89B6E`    | 主品牌色，用于强调和高亮        |
| **prosperity-light-gold** | `#D4C19A`  | 辅助金色，用于浅色背景和描边    |
| **prosperity-dark-gold** | `#8F7A50`   | 深色金色，用于深色文本和图标    |
| **prosperity-gray**   | `#2A2A2A`    | 卡片背景色，深灰色             |
| **prosperity-light-gray** | `#505050`  | 辅助文本色，浅灰色             |

#### **6.2 视觉层次**
- **主色调**：`prosperity-gold` (#B89B6E) - 用于品牌标识、重要按钮和强调内容
- **背景色**：`prosperity-black` (#0A0A0A) - 纯净黑色背景，突出视频内容
- **卡片容器**：`prosperity-gray` (#2A2A2A) - 为UI元素提供清晰的视觉分割
- **文字层次**：通过金色的不同深浅度区分主次内容

#### **6.3 品牌理念**
这套配色系统体现了"繁荣(prosperity)"的品牌内核：
- **黑色**象征专业、稳定、值得信赖
- **金色**象征高质量、珍贵、专业水准
- **暖金渐变**营造温暖、友好、易用的用户体验

---
**文档结束**